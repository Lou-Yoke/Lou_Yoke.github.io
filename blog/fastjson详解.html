<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>fastjson详解 | Lou&#39;Home</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/logo.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/logo.png">
    <meta name="description" content="Keep track of your life！">
    <link rel="preload" href="/assets/css/0.styles.b61369ba.css" as="style"><link rel="preload" href="/assets/js/app.a5b31fbb.js" as="script"><link rel="preload" href="/assets/js/3.9af23e16.js" as="script"><link rel="preload" href="/assets/js/1.bfee3624.js" as="script"><link rel="preload" href="/assets/js/32.f3209a9f.js" as="script"><link rel="prefetch" href="/assets/js/10.9a25549d.js"><link rel="prefetch" href="/assets/js/11.0cf159a7.js"><link rel="prefetch" href="/assets/js/12.4a00d287.js"><link rel="prefetch" href="/assets/js/13.2ba89b90.js"><link rel="prefetch" href="/assets/js/14.7c5c8821.js"><link rel="prefetch" href="/assets/js/15.c4b26850.js"><link rel="prefetch" href="/assets/js/16.4a39f39e.js"><link rel="prefetch" href="/assets/js/17.cb79f53d.js"><link rel="prefetch" href="/assets/js/18.7e43aabd.js"><link rel="prefetch" href="/assets/js/19.57153f72.js"><link rel="prefetch" href="/assets/js/20.863f7bec.js"><link rel="prefetch" href="/assets/js/21.5cea7004.js"><link rel="prefetch" href="/assets/js/22.c3d988b5.js"><link rel="prefetch" href="/assets/js/23.08efe1d9.js"><link rel="prefetch" href="/assets/js/24.c36b914c.js"><link rel="prefetch" href="/assets/js/25.bd4cba7c.js"><link rel="prefetch" href="/assets/js/26.53021dfb.js"><link rel="prefetch" href="/assets/js/27.9b069ef9.js"><link rel="prefetch" href="/assets/js/28.c2afba32.js"><link rel="prefetch" href="/assets/js/29.981a0c4f.js"><link rel="prefetch" href="/assets/js/30.46cb4b89.js"><link rel="prefetch" href="/assets/js/31.dfde7949.js"><link rel="prefetch" href="/assets/js/33.e9bccb51.js"><link rel="prefetch" href="/assets/js/34.135c7c1f.js"><link rel="prefetch" href="/assets/js/35.a5a9a5e6.js"><link rel="prefetch" href="/assets/js/36.e50117d5.js"><link rel="prefetch" href="/assets/js/37.27a96eae.js"><link rel="prefetch" href="/assets/js/38.c9d57035.js"><link rel="prefetch" href="/assets/js/39.84190e2e.js"><link rel="prefetch" href="/assets/js/4.5921dfe2.js"><link rel="prefetch" href="/assets/js/40.18e66c2d.js"><link rel="prefetch" href="/assets/js/41.cadacc4c.js"><link rel="prefetch" href="/assets/js/42.0180e782.js"><link rel="prefetch" href="/assets/js/43.2e042c77.js"><link rel="prefetch" href="/assets/js/44.df08dc20.js"><link rel="prefetch" href="/assets/js/45.a17d56df.js"><link rel="prefetch" href="/assets/js/46.b71cbf08.js"><link rel="prefetch" href="/assets/js/47.75f265ff.js"><link rel="prefetch" href="/assets/js/48.f16ddd2f.js"><link rel="prefetch" href="/assets/js/5.4cf651d5.js"><link rel="prefetch" href="/assets/js/6.c524588a.js"><link rel="prefetch" href="/assets/js/7.51d6bc29.js"><link rel="prefetch" href="/assets/js/8.e9ab6950.js"><link rel="prefetch" href="/assets/js/9.7954cbdc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b61369ba.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-19557b78><div data-v-19557b78><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-19557b78 data-v-19557b78><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-19557b78 data-v-19557b78><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Lou'Home</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Lou'Home</span>
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-19557b78><header class="navbar" data-v-19557b78><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.ico" alt="Lou'Home" class="logo"> <span class="site-name">Lou'Home</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont undefined"></i>
  首页
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      文章
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  blog
</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Lou-Yoke" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-19557b78></div> <aside class="sidebar" data-v-19557b78><div class="personal-info-wrapper" data-v-b038cec6><img src="/logo.ico" alt="author-avatar" class="personal-img" data-v-b038cec6> <h3 class="name" data-v-b038cec6>
    Lou'Home
  </h3> <div class="num" data-v-b038cec6><div data-v-b038cec6><h3 data-v-b038cec6>35</h3> <h6 data-v-b038cec6>Article</h6></div> <div data-v-b038cec6><h3 data-v-b038cec6>46</h3> <h6 data-v-b038cec6>Tag</h6></div></div> <hr data-v-b038cec6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont undefined"></i>
  首页
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      文章
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  blog
</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Lou-Yoke" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>fastjson详解</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/fastjson%E8%AF%A6%E8%A7%A3.html#简单使用" class="sidebar-link">简单使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/fastjson%E8%AF%A6%E8%A7%A3.html#serializerfeature特性的使用" class="sidebar-link">SerializerFeature特性的使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/fastjson%E8%AF%A6%E8%A7%A3.html#jsonfield与jsontype注解的使用" class="sidebar-link">JSONField与JSONType注解的使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/fastjson%E8%AF%A6%E8%A7%A3.html#serializefilter" class="sidebar-link">SerializeFilter</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/fastjson%E8%AF%A6%E8%A7%A3.html#泛型反序列化" class="sidebar-link">泛型反序列化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/fastjson%E8%AF%A6%E8%A7%A3.html#fastjson各种概念" class="sidebar-link">fastjson各种概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/fastjson%E8%AF%A6%E8%A7%A3.html#序列化相关的概念" class="sidebar-link">序列化相关的概念</a></li><li class="sidebar-sub-header"><a href="/blog/fastjson%E8%AF%A6%E8%A7%A3.html#反序列化相关的概念" class="sidebar-link">反序列化相关的概念</a></li></ul></li><li><a href="/blog/fastjson%E8%AF%A6%E8%A7%A3.html#与spring-mvc整合" class="sidebar-link">与Spring MVC整合</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-19557b78><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>fastjson详解</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Lou'Home</span>
            
          <!---->
          2020
        </a></span></div></div> <div data-v-19557b78><main class="page"><div class="page-title" style="display:none;"><h1>fastjson详解</h1> <hr> <div data-v-484a899e><i class="iconfont reco-account" data-v-484a899e><span data-v-484a899e>Lou'Home</span></i> <i class="iconfont reco-date" data-v-484a899e><span data-v-484a899e>2020-04-03 15:53:18</span></i> <!----> <i class="iconfont reco-tag tags" data-v-484a899e><span class="tag-item" data-v-484a899e>
      fastjson
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="fastjson详解"><a href="#fastjson详解" class="header-anchor">#</a> fastjson详解</h1> <p>fastjson用于将Java Bean序列化为JSON字符串，也可以从JSON字符串反序列化到JavaBean。</p> <h2 id="简单使用"><a href="#简单使用" class="header-anchor">#</a> 简单使用</h2> <p>通过maven引入相应的json包</p> <div class="language- extra-class"><pre><code>&lt;dependencies&gt;  
    &lt;dependency&gt;  
        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;  
        &lt;artifactId&gt;fastjson&lt;/artifactId&gt;  
        &lt;version&gt;1.2.49&lt;/version&gt;  
    &lt;/dependency&gt;  
&lt;/dependencies&gt;  
</code></pre></div><p>定义一个需要转换所实体类User，代码如下：</p> <div class="language- extra-class"><pre><code>package com.ivan.json.entity;  
  
import java.util.Date;  
  
import com.alibaba.fastjson.annotation.JSONField;  
  
public class User {  
  
    private Long   id;  
  
    private String name;  
  
    @JSONField(format = &quot;yyyy-MM-dd HH:mm:ss&quot;)  
    private Date   createTime;  
  
    public Long getId() {  
        return id;  
    }  
  
    public void setId(Long id) {  
        this.id = id;  
    }  
  
    public String getName() {  
        return name;  
    }  
  
    public void setName(String name) {  
        this.name = name;  
    }  
  
    public Date getCreateTime() {  
        return createTime;  
    }  
  
    public void setCreateTime(Date createTime) {  
        this.createTime = createTime;  
    }  
      
}  
</code></pre></div><p>写个简单的测试类用于测试fastjson的序列化与反序列化，代码如下：</p> <div class="language- extra-class"><pre><code>package com.ivan.json;  
  
import java.util.Date;  
  
import com.alibaba.fastjson.JSON;  
import com.ivan.json.entity.User;  
  
public class SimpleTest {  
  
    public static void main(String[] args) {  
        serialize();  
        deserialize();  
    }  
  
    public static void serialize() {  
        User user = new User();  
        user.setId(11L);  
        user.setName(&quot;西安&quot;);  
        user.setCreateTime(new Date());  
        String jsonString = JSON.toJSONString(user);  
        System.out.println(jsonString);  
    }  
  
    public static void deserialize() {  
        String jsonString = &quot;{\&quot;createTime\&quot;:\&quot;2018-08-17 14:38:38\&quot;,\&quot;id\&quot;:11,\&quot;name\&quot;:\&quot;西安\&quot;}&quot;;  
        User user = JSON.parseObject(jsonString, User.class);  
        System.out.println(user.getName());  
        System.out.println(user.getCreateTime());  
    }  
}  
</code></pre></div><h2 id="serializerfeature特性的使用"><a href="#serializerfeature特性的使用" class="header-anchor">#</a> SerializerFeature特性的使用</h2> <p>fastjson通过SerializerFeature对生成的json格式的数据进行一些定制，比如可以输入的格式更好看，使用单引号而非双引号等。例子程序如下：</p> <div class="language- extra-class"><pre><code>package com.ivan.json;  
  
import java.util.Date;  
  
import com.alibaba.fastjson.JSON;  
import com.alibaba.fastjson.serializer.SerializerFeature;  
import com.ivan.json.entity.User;  
  
public class SerializerFeatureTest {  
  
    public static void main(String[] args) {  
        User user = new User();  
        user.setId(11L);  
        user.setCreateTime(new Date());  
        String jsonString = JSON.toJSONString(user, SerializerFeature.PrettyFormat,   
                SerializerFeature.WriteNullStringAsEmpty, SerializerFeature.UseSingleQuotes);  
        System.out.println(jsonString);  
  
    }  
  
}  
</code></pre></div><p>输出的结果如下：<br>
![](https://upload-
images.jianshu.io/upload_images/5796101-e4258d1405f31078.png?imageMogr2/auto-
orient/strip%7CimageView2/2/w/798/format/webp)</p> <p>SerializerFeature常用属性</p> <table><thead><tr><th>名称</th> <th>含义</th></tr></thead> <tbody><tr><td>QuoteFieldNames</td> <td>输出key时是否使用双引号,默认为true</td></tr> <tr><td>UseSingleQuotes</td> <td>使用单引号而不是双引号,默认为false</td></tr> <tr><td>WriteMapNullValue</td> <td>是否输出值为null的字段,默认为false</td></tr> <tr><td>WriteEnumUsingToString</td> <td>Enum输出name()或者original,默认为false</td></tr> <tr><td>UseISO8601DateFormat</td> <td>Date使用ISO8601格式输出，默认为false</td></tr> <tr><td>WriteNullListAsEmpty</td> <td>List字段如果为null,输出为[],而非null</td></tr> <tr><td>WriteNullStringAsEmpty</td> <td>字符类型字段如果为null,输出为”“,而非null</td></tr></tbody></table> <p>WriteNullNumberAsZero|数值字段如果为null,输出为0,而非null|<br>
|WriteNullBooleanAsFalse|<br>
Boolean字段如果为null,输出为false,而非null|<br>
|SkipTransientField|如果是true，类中的Get方法对应的Field是transient，序列化时将会被忽略。默认为true|<br>
|SortField|按字段名称排序后输出。默认为false|<br>
|WriteTabAsSpecial|把\t做转义输出，默认为false不推荐设为true|<br>
|PrettyFormat|结果是否格式化,默认为false|<br>
|WriteClassName|序列化时写入类型信息，默认为false。反序列化是需用到|<br>
|DisableCircularReferenceDetect|消除对同一对象循环引用的问题，默认为false|<br>
|WriteSlashAsSpecial|对斜杠’/’进行转义|<br>
|BrowserCompatible|将中文都会序列化为\uXXXX格式，字节数会多一些，但是能兼容IE 6，默认为false|<br>
|WriteDateUseDateFormat|全局修改日期格式,默认为false。|<br>
|DisableCheckSpecialChar|一个对象的字符串属性中如果有特殊字符如双引号，将会在转成json时带有反斜杠转移符。如果不需要转义，可以使用这个属性。默认为false|<br>
|BeanToArray|将对象转为array输出|</p> <h2 id="jsonfield与jsontype注解的使用"><a href="#jsonfield与jsontype注解的使用" class="header-anchor">#</a> JSONField与JSONType注解的使用</h2> <p>fastjson提供了JSONField对序列化与反序列化进行定制，比如可以指定字段的名称，序列化的顺序。JSONField用于属性，方法方法参数上。JSONField的源码如下：</p> <div class="language- extra-class"><pre><code>package com.alibaba.fastjson.annotation;  
  
import java.lang.annotation.ElementType;  
import java.lang.annotation.Retention;  
import java.lang.annotation.RetentionPolicy;  
import java.lang.annotation.Target;  
import com.alibaba.fastjson.parser.Feature;  
import com.alibaba.fastjson.serializer.SerializerFeature;  
  
@Retention(RetentionPolicy.RUNTIME)  
@Target({ ElementType.METHOD, ElementType.FIELD, ElementType.PARAMETER })  
public @interface JSONField {  
// 配置序列化和反序列化的顺序  
    int ordinal() default 0;  
// 指定字段的名称  
    String name() default &quot;&quot;;  
// 指定字段的格式，对日期格式有用  
    String format() default &quot;&quot;;  
 // 是否序列化  
    boolean serialize() default true;  
// 是否反序列化  
    boolean deserialize() default true;  
//字段级别的SerializerFeature  
    SerializerFeature[] serialzeFeatures() default {};  
//  
    Feature[] parseFeatures() default {};  
   //给属性打上标签， 相当于给属性进行了分组  
    String label() default &quot;&quot;;  
      
    boolean jsonDirect() default false;  
      
//制定属性的序列化类  
    Class&lt;?&gt; serializeUsing() default Void.class;  
 //制定属性的反序列化类  
    Class&lt;?&gt; deserializeUsing() default Void.class;  
  
    String[] alternateNames() default {};  
  
    boolean unwrapped() default false;  
}  
</code></pre></div><p>其中serializeUsing与deserializeUsing可以用于对字段的序列化与反序列化进行定制化。比如我们在User实体上加上个sex属性，类型为boolean。下面分别定义了序列化类与反序列化类，序列化类代码如下：</p> <div class="language- extra-class"><pre><code>package com.ivan.json.converter;  
  
import java.io.IOException;  
import java.lang.reflect.Type;  
  
import com.alibaba.fastjson.serializer.JSONSerializer;  
import com.alibaba.fastjson.serializer.ObjectSerializer;  
  
public class SexSerializer implements ObjectSerializer {  
  
    public void write(JSONSerializer serializer,  
                      Object object,  
                      Object fieldName,  
                      Type fieldType,  
                      int features)  
            throws IOException {  
        Boolean value = (Boolean) object;  
        String text = &quot;女&quot;;  
        if (value != null &amp;&amp; value == true) {  
            text = &quot;男&quot;;  
        }  
        serializer.write(text);  
    }  
  
}  
</code></pre></div><p>反序列化类代码如下：</p> <div class="language- extra-class"><pre><code>package com.ivan.json.converter;  
  
import java.lang.reflect.Type;  
</code></pre></div><p>​<br>
​    import com.alibaba.fastjson.parser.DefaultJSONParser;<br>
​    import com.alibaba.fastjson.parser.JSONToken;<br>
​    import com.alibaba.fastjson.parser.deserializer.ObjectDeserializer;<br>
​<br>
​    public class SexDeserialize implements ObjectDeserializer {<br>
​<br>
public <T> T deserialze(DefaultJSONParser parser,<br>
Type type,<br>
Object fieldName) {</T></p> <p>​<br>
​<br>
​            String sex = parser.parseObject(String.class);<br>
​            if (&quot;男&quot;.equals(sex)) {<br>
​                return (T) Boolean.TRUE;<br>
​            } else {<br>
​                return (T) Boolean.FALSE;<br>
​            }<br>
​        }<br>
​<br>
​        public int getFastMatchToken() {<br>
​            return JSONToken.UNDEFINED;<br>
​        }<br>
​<br>
}</p> <p>fastjosn提供了JSONType用于类级别的定制化, JSONType的源码如下：</p> <div class="language- extra-class"><pre><code>package com.alibaba.fastjson.annotation;  
  
import java.lang.annotation.ElementType;  
import java.lang.annotation.Retention;  
import java.lang.annotation.RetentionPolicy;  
import java.lang.annotation.Target;  
  
import com.alibaba.fastjson.PropertyNamingStrategy;  
import com.alibaba.fastjson.parser.Feature;  
import com.alibaba.fastjson.serializer.SerializeFilter;  
import com.alibaba.fastjson.serializer.SerializerFeature;  
  
@Retention(RetentionPolicy.RUNTIME)  
//需要标注在类上  
@Target({ ElementType.TYPE })  
public @interface JSONType {  
  
    boolean asm() default true;  
//这里可以定义输出json的字段顺序  
    String[] orders() default {};  
//包含的字段  
    String[] includes() default {};  
//不包含的字段  
    String[] ignores() default {};  
//类级别的序列化特性定义  
    SerializerFeature[] serialzeFeatures() default {};  
    Feature[] parseFeatures() default {};  
    //按字母顺序进行输出  
    boolean alphabetic() default true;  
      
    Class&lt;?&gt; mappingTo() default Void.class;  
      
    Class&lt;?&gt; builder() default Void.class;  
      
    String typeName() default &quot;&quot;;  
  
    String typeKey() default &quot;&quot;;  
      
    Class&lt;?&gt;[] seeAlso() default{};  
    //序列化类  
    Class&lt;?&gt; serializer() default Void.class;  
    //反序列化类  
    Class&lt;?&gt; deserializer() default Void.class;  
  
    boolean serializeEnumAsJavaBean() default false;  
  
    PropertyNamingStrategy naming() default PropertyNamingStrategy.CamelCase;  
  
    Class&lt;? extends SerializeFilter&gt;[] serialzeFilters() default {};  
}  
</code></pre></div><h2 id="serializefilter"><a href="#serializefilter" class="header-anchor">#</a> SerializeFilter</h2> <p>fastjson通过SerializeFilter编程扩展的方式定制序列化fastjson支持以下SerializeFilter用于不同常景的定制序列化：</p> <p>PropertyFilter 根据PropertyName和PropertyValue来判断是否序列化,接口定义如下：</p> <div class="language- extra-class"><pre><code>package com.alibaba.fastjson.serializer;  
  
/**  
 * @author wenshao[szujobs@hotmail.com]  
 */  
public interface PropertyFilter extends SerializeFilter {  
  
    /**  
     * @param object the owner of the property  
     * @param name the name of the property  
     * @param value the value of the property  
     * @return true if the property will be included, false if to be filtered out  
    * 根据 属性的name与value判断是否进行序列化  
     */  
    boolean apply(Object object, String name, Object value);  
}  
</code></pre></div><p>PropertyPreFilter根据PropertyName判断是否序列化</p> <div class="language- extra-class"><pre><code>package com.alibaba.fastjson.serializer;  
  
public interface PropertyPreFilter extends SerializeFilter {  
  
//根据 object与name判断是否进行序列化  
    boolean apply(JSONSerializer serializer, Object object, String name);  
}  
</code></pre></div><p>NameFilter 序列化时修改Key</p> <div class="language- extra-class"><pre><code>package com.alibaba.fastjson.serializer;  
  
public interface NameFilter extends SerializeFilter {  
//根据 name与value的值，返回json字段key的值  
    String process(Object object, String name, Object value);  
}  
</code></pre></div><p>ValueFilter 序列化时修改Value</p> <div class="language- extra-class"><pre><code>package com.alibaba.fastjson.serializer;  
  
public interface ValueFilter extends SerializeFilter {  
  //根据name与value定制输出json的value  
    Object process(Object object, String name, Object value);  
}  
</code></pre></div><p>BeforeFilter 在序列化对象的所有属性之前执行某些操作</p> <div class="language- extra-class"><pre><code>package com.alibaba.fastjson.serializer;  
  
public abstract class BeforeFilter implements SerializeFilter {  
  
    private static final ThreadLocal&lt;JSONSerializer&gt; serializerLocal = new ThreadLocal&lt;JSONSerializer&gt;();  
    private static final ThreadLocal&lt;Character&gt;      seperatorLocal  = new ThreadLocal&lt;Character&gt;();  
  
    private final static Character                   COMMA           = Character.valueOf(',');  
  
    final char writeBefore(JSONSerializer serializer, Object object, char seperator) {  
        serializerLocal.set(serializer);  
        seperatorLocal.set(seperator);  
        writeBefore(object);  
        serializerLocal.set(null);  
        return seperatorLocal.get();  
    }  
  
    protected final void writeKeyValue(String key, Object value) {  
        JSONSerializer serializer = serializerLocal.get();  
        char seperator = seperatorLocal.get();  
        serializer.writeKeyValue(seperator, key, value);  
        if (seperator != ',') {  
            seperatorLocal.set(COMMA);  
        }  
    }  
//需要实现的方法，在实际实现中可以调用writeKeyValue增加json的内容  
    public abstract void writeBefore(Object object);  
}  
</code></pre></div><p>AfterFilter 在序列化对象的所有属性之后执行某些操作</p> <div class="language- extra-class"><pre><code>package com.alibaba.fastjson.serializer;  
  
/**  
 * @since 1.1.35  
 */  
public abstract class AfterFilter implements SerializeFilter {  
  
    private static final ThreadLocal&lt;JSONSerializer&gt; serializerLocal = new ThreadLocal&lt;JSONSerializer&gt;();  
    private static final ThreadLocal&lt;Character&gt;      seperatorLocal  = new ThreadLocal&lt;Character&gt;();  
  
    private final static Character                   COMMA           = Character.valueOf(',');  
  
    final char writeAfter(JSONSerializer serializer, Object object, char seperator) {  
        serializerLocal.set(serializer);  
        seperatorLocal.set(seperator);  
        writeAfter(object);  
        serializerLocal.set(null);  
        return seperatorLocal.get();  
    }  
  
    protected final void writeKeyValue(String key, Object value) {  
        JSONSerializer serializer = serializerLocal.get();  
        char seperator = seperatorLocal.get();  
        serializer.writeKeyValue(seperator, key, value);  
        if (seperator != ',') {  
            seperatorLocal.set(COMMA);  
        }  
    }  
//子类需要实现的方法，实际使用的时候可以调用writeKeyValue增加内容  
    public abstract void writeAfter(Object object);  
}  
</code></pre></div><p>LabelFilter根据 JsonField配置的label来判断是否进行输出</p> <div class="language- extra-class"><pre><code>package com.alibaba.fastjson.serializer;  
  
//根据 JsonField配置的label来判断是否进行输出  
public interface LabelFilter extends SerializeFilter {  
    boolean apply(String label);  
}  
</code></pre></div><h2 id="泛型反序列化"><a href="#泛型反序列化" class="header-anchor">#</a> 泛型反序列化</h2> <p>fastjson通过TypeReference来实现泛型的反序列化，以下是一个简单的例子程序。首先定义了BaseDTO用于所有DTO的父类，代码如下：</p> <div class="language- extra-class"><pre><code>package com.ivan.frame.dto.common;  
  
import java.io.Serializable;  
  
import com.alibaba.fastjson.JSONObject;  
  
public class BaseDTO implements Serializable{  
  
    private static final long  serialVersionUID = 2230553030766621644L;  
  
    @Override  
    public String toString() {  
        return JSONObject.toJSONString(this);  
    }  
  
}  
</code></pre></div><p>RequestDTO用于抽像所有的请求DTO，里面有个泛型参数，代码如下：</p> <div class="language- extra-class"><pre><code>package com.ivan.frame.dto.common;  
</code></pre></div><p>​<br>
​    public final class RequestDTO<T extends="" BaseDTO=""> extends BaseDTO {<br>
​<br>
​        private static final long serialVersionUID = -2780042604928728379L;<br>
​<br>
/**<br>
* 调用方的名称<br>
*/<br>
private String            caller;</T></p> <div class="language- extra-class"><pre><code>    /**  
     * 请求参数  
     */  
    private T                 param;  
</code></pre></div><p>​<br>
​<br>
​        public String getCaller() {<br>
​            return caller;<br>
​        }<br>
​<br>
​        public void setCaller(String caller) {<br>
​            this.caller = caller;<br>
​        }<br>
​<br>
/**<br>
* 获取请求参数<br>
*/<br>
public T getParam() {<br>
return param;<br>
}</p> <div class="language- extra-class"><pre><code>    /**  
     * 设置请求参数  
     *   
     * @param param 请求参数  
     */  
    public void setParam(T param) {  
        this.param = param;  
    }  
  
}  
</code></pre></div><p>定义一个具体的业务对象， PersonDTO代码如下：</p> <div class="language- extra-class"><pre><code>package com.ivan.frame.dto;  
  
import com.ivan.frame.dto.common.BaseDTO;  
  
public class PersonDTO extends BaseDTO {  
      
    private static final long serialVersionUID = 4637634512292751986L;  
      
    private int id;  
    private int age;  
    private String name;  
      
    public int getId() {  
        return id;  
    }  
    public void setId(int id) {  
        this.id = id;  
    }  
    public int getAge() {  
        return age;  
    }  
    public void setAge(int age) {  
        this.age = age;  
    }  
    public String getName() {  
        return name;  
    }  
    public void setName(String name) {  
        this.name = name;  
    }  
      
}  
</code></pre></div><p>通过JSON.parseObject传入TypeReference对象进行泛型转换，代码如下：</p> <p>​<br>
​    package com.ivan.json;<br>
​<br>
​    import com.alibaba.fastjson.JSON;<br>
​    import com.alibaba.fastjson.TypeReference;<br>
​    import com.ivan.frame.dto.PersonDTO;<br>
​    import com.ivan.frame.dto.common.RequestDTO;<br>
​<br>
public class GenericTest {</p> <div class="language- extra-class"><pre><code>    public static void main(String[] args) {  
        RequestDTO&lt;PersonDTO&gt; requestDTO = new RequestDTO&lt;PersonDTO&gt;();  
        requestDTO.setCaller(&quot;callerId&quot;);  
        PersonDTO personDTO = new PersonDTO();  
        personDTO.setAge(11);  
        personDTO.setName(&quot;张三&quot;);  
        requestDTO.setParam(personDTO);  
          
        String jsonString = JSON.toJSONString(requestDTO);  
        System.out.println(jsonString);  
        //这行是关键代码  
        requestDTO = JSON.parseObject(jsonString, new TypeReference&lt;RequestDTO&lt;PersonDTO&gt;&gt;(){});  
</code></pre></div><p>​<br>
​            System.out.println(requestDTO.getParam().getName());<br>
​        }<br>
​    }</p> <h2 id="fastjson各种概念"><a href="#fastjson各种概念" class="header-anchor">#</a> fastjson各种概念</h2> <ul><li>JSON：本身是Abstract，提供了一系统的工具方法方便用户使用的API。</li></ul> <h3 id="序列化相关的概念"><a href="#序列化相关的概念" class="header-anchor">#</a> 序列化相关的概念</h3> <ul><li>SerializeConfig：内部是个map容器主要功能是配置并记录每种Java类型对应的序列化类。</li> <li>SerializeWriter 继承自Java的Writer，其实就是个转为FastJSON而生的</li> <li>StringBuilder，完成高性能的字符串拼接。</li> <li>SerializeFilter: 用于对对象的序列化实现各种定制化的需求。</li> <li>SerializerFeature：对于对输出的json做各种格式化的需求。</li> <li>JSONSerializer：相当于一个序列化组合器，集成了SerializeConfig， SerializeWriter ， SerializeFilter与SerializerFeature。</li></ul> <p>序列化的入口代码如下，上面提到的各种概念都包含了</p> <div class="language- extra-class"><pre><code>public static String toJSONString(Object object, //   
                                  SerializeConfig config, //   
                                  SerializeFilter[] filters, //   
                                  String dateFormat, //  
                                  int defaultFeatures, //   
                                  SerializerFeature... features) {  
    SerializeWriter out = new SerializeWriter(null, defaultFeatures, features);  
  
    try {  
        JSONSerializer serializer = new JSONSerializer(out, config);  
          
        if (dateFormat != null &amp;&amp; dateFormat.length() != 0) {  
            serializer.setDateFormat(dateFormat);  
            serializer.config(SerializerFeature.WriteDateUseDateFormat, true);  
        }  
  
        if (filters != null) {  
            for (SerializeFilter filter : filters) {  
                serializer.addFilter(filter);  
            }  
        }  
  
        serializer.write(object);  
  
        return out.toString();  
    } finally {  
        out.close();  
    }  
}  
</code></pre></div><h3 id="反序列化相关的概念"><a href="#反序列化相关的概念" class="header-anchor">#</a> 反序列化相关的概念</h3> <ul><li><p>ParserConfig：内部通过一个map保存各种ObjectDeserializer。</p></li> <li><p>JSONLexer : 与SerializeWriter相对应，用于解析json字符串。</p></li> <li><p>JSONToken：定义了一系统的特殊字符，这些称为token。</p></li> <li><p>ParseProcess ：定制反序列化，类似于SerializeFilter。</p></li> <li><p>Feature：用于定制各种反序列化的特性。</p></li> <li><p>DefaultJSONParser：相当于反序列化组合器，集成了ParserConfig，Feature， JSONLexer 与ParseProcess。</p></li> <li><p>反序列化的入口代码如下，上面的概念基本都包含了：</p> <div class="language- extra-class"><pre><code>@SuppressWarnings(&quot;unchecked&quot;)  
</code></pre></div><p>public static <T> T parseObject(String input, Type clazz, ParserConfig config, ParseProcess processor,<br>
int featureValues, Feature... features) {<br>
if (input == null) {<br>
return null;<br>
}</T></p> <div class="language- extra-class"><pre><code>if (features != null) {  
    for (Feature feature : features) {  
        featureValues |= feature.mask;  
    }  
}  
  
DefaultJSONParser parser = new DefaultJSONParser(input, config, featureValues);  
  
if (processor != null) {  
    if (processor instanceof ExtraTypeProvider) {  
        parser.getExtraTypeProviders().add((ExtraTypeProvider) processor);  
    }  
  
    if (processor instanceof ExtraProcessor) {  
        parser.getExtraProcessors().add((ExtraProcessor) processor);  
    }  
  
    if (processor instanceof FieldTypeResolver) {  
        parser.setFieldTypeResolver((FieldTypeResolver) processor);  
    }  
}  
  
T value = (T) parser.parseObject(clazz, null);  
  
parser.handleResovleTask(value);  
  
parser.close();  
  
return (T) value;  
</code></pre></div><p>}</p></li></ul> <h2 id="与spring-mvc整合"><a href="#与spring-mvc整合" class="header-anchor">#</a> 与Spring MVC整合</h2> <p>fastjson提供了FastJsonHttpMessageConverter用于将Spring
mvc里的body数据(必须是json格式)转成Controller里的请求参数或者将输出的对象转成json格式的数据。spring
mvc里的核心配置如下：</p> <div class="language- extra-class"><pre><code>&lt;mvc:annotation-driven conversion-service=&quot;conversionService&quot;&gt;  
    &lt;mvc:message-converters register-defaults=&quot;true&quot;&gt;  
        &lt;bean  
            class=&quot;com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter&quot;&gt;  
            &lt;property name=&quot;supportedMediaTypes&quot;&gt;  
                &lt;list&gt;  
                    &lt;value&gt;text/html;charset=UTF-8&lt;/value&gt;  
                    &lt;value&gt;application/json;charset=UTF-8&lt;/value&gt;  
                &lt;/list&gt;  
            &lt;/property&gt;  
            &lt;property name=&quot;features&quot;&gt;  
                &lt;array&gt;  
                    &lt;value&gt;WriteMapNullValue&lt;/value&gt;  
                    &lt;value&gt;WriteNullStringAsEmpty&lt;/value&gt;  
                &lt;/array&gt;  
            &lt;/property&gt;  
        &lt;/bean&gt;  
    &lt;/mvc:message-converters&gt;  
&lt;/mvc:annotation-driven&gt;  
</code></pre></div><p>这里有一个注意点，当你用Spring
3或者fastjson使用的是1.1.x的版本，在转换带有泛型参数类型的时候无法进行转换，而在Spring4配合fastjson1.2.X的版本可以解决这个问题。FastJsonHttpMessageConverter
read的核心代码如下：</p> <p>​<br>
​    public class FastJsonHttpMessageConverter extends AbstractHttpMessageConverter<Object>//<br>
​            implements GenericHttpMessageConverter<Object> {<br>
​<br>
​    //将json转成javabean的时候会调用。这里的type<br>
​        public Object read(Type type, //<br>
​                           Class&lt;?&gt; contextClass, //<br>
​                           HttpInputMessage inputMessage //<br>
​        ) throws IOException, HttpMessageNotReadableException {<br>
​            return readType(getType(type, contextClass), inputMessage);<br>
​        }<br>
​<br>
//这里会通过Spring4TypeResolvableHelper得到类型参数，<br>
protected Type getType(Type type, Class&lt;?&gt; contextClass) {<br>
if (Spring4TypeResolvableHelper.isSupport()) {<br>
return Spring4TypeResolvableHelper.getType(type, contextClass);<br>
}</Object></Object></p> <div class="language- extra-class"><pre><code>        return type;  
    }  
  
}  </code></pre></div></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div></div></div>
    <script src="/assets/js/app.a5b31fbb.js" defer></script><script src="/assets/js/3.9af23e16.js" defer></script><script src="/assets/js/1.bfee3624.js" defer></script><script src="/assets/js/32.f3209a9f.js" defer></script>
  </body>
</html>
